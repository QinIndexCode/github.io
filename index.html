<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="QinIndexCode - 个人技术博客，专注于全栈开发、Web开发、移动应用开发等技术领域">
    <meta name="theme-color" content="#0B0C15">
    <title>个人技术博客 QinIndexCode</title>
    <link href="./css/css2.css" rel="stylesheet">
    <link href="./css/main.css" rel="stylesheet">
    <script src="./js/smooth-scroll.js" defer></script>
    <style>
        /* 浮动文字优化 */
        .floating-text {
            position: absolute;
            top: -40px;
            left: 50%;
            transform: translateX(-50%) scale(0.8);
            background: rgba(99, 102, 241, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            pointer-events: none;
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            white-space: normal; /* Allow wrap */
            min-width: 120px; /* Min width */
            max-width: 200px; /* Max width constraint */
            text-align: center;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            font-weight: 600;
            font-size: 0.875rem;
            line-height: 1.4;
        }
        
        /* Triangle arrow */
        .floating-text::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 6px 6px 0;
            border-style: solid;
            border-color: rgba(99, 102, 241, 0.9) transparent transparent transparent;
        }

        .floating-text.show { 
            opacity: 1; 
            transform: translateX(-50%) scale(1) translateY(-10px);
        }

        /* 主题选择器按钮 (简化版) */
        .theme-selector {
            position: fixed;
            top: 1.5rem;
            right: 2rem;
            z-index: 100;
        }

        .theme-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--text-primary);
            transition: var(--transition-base);
            box-shadow: var(--shadow-sm);
            position: relative;
            z-index: 101;
        }

        .theme-btn:hover {
            background: var(--glass-bg-hover);
            transform: scale(1.05);
        }

        .stat-num {
            font-size: 2rem;
            font-weight: 700;
            color: var(--stat-color, #fff);
            display: block;
        }

        /* Hero Section */
        .hero {
            min-height: 60vh;
            display: flex;
            align-items: center;
            position: relative;
        }

        .hero-content {
            z-index: 2;
        }

        .hero h1 {
            font-size: clamp(2.5rem, 5vw, 4rem);
            background: var(--hero-text-gradient, linear-gradient(to right, #fff, #94a3b8));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: var(--spacing-md);
        }

        .hero p.tagline {
            font-size: 1.25rem;
            color: var(--accent-blue);
            font-weight: 500;
            margin-bottom: var(--spacing-xl);
            display: inline-block;
            padding: 0.5rem 1rem;
            background: rgba(99, 102, 241, 0.1);
            border-radius: 50px;
            border: 1px solid rgba(99, 102, 241, 0.2);
        }

        .section-title {
            color: var(--text-primary); /* Ensure titles adapt */
        }

        /* Avatar Wrapper with Glow */
        .avatar-wrapper {
            position: relative;
            width: 280px;
            height: 280px;
            margin: 0 auto;
            border-radius: 50%;
            padding: 5px;
            background: var(--gradient-primary);
            box-shadow: 0 0 50px rgba(99, 102, 241, 0.3);
            animation: float 6s ease-in-out infinite;
        }

        .avatar-wrapper img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%;
            background: var(--bg-primary);
            border: 4px solid var(--bg-primary);
        }

        .profile-name {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--profile-name-color, var(--text-primary));
            letter-spacing: 0.025em;
        }
    </style>
</head>
<body>
    <!-- 移动端菜单按钮 (动画版) -->
    <button class="hamburger-btn" id="hamburger-btn" aria-label="Menu">
        <span></span>
        <span></span>
        <span></span>
    </button>
    
    <!-- 主题选择器 -->
    <div class="theme-selector" id="theme-selector">
        <button class="theme-btn" id="theme-btn" aria-label="Toggle Theme">
            <!-- Moon Icon (Dark Mode) -->
            <svg id="icon-dark" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
            <!-- Sun Icon (Light Mode) - Hidden by default -->
            <svg id="icon-light" style="display:none;" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
        </button>
    </div>
    
    <!-- 侧边栏遮罩层 -->
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="main-container">
        <!-- 侧边栏 -->
        <aside class="sidebar glass" id="sidebar">
            <div class="profile-section">
                <div class="profile-avatar" id="avatar">
                    <img src="assets/images/avatar.jpg" alt="Avatar" width="100" height="100" loading="lazy">
                    <div class="floating-text" id="floating-text"></div>
                </div>
                <div class="profile-name">QinIndexCode</div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <div class="nav-link active" data-target="home" data-src="home.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/home.svg" class="nav-icon" alt="Home"></div>
                        <span>首页</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" data-target="tech" data-src="tech.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/technical.svg" class="nav-icon" alt="Tech"></div>
                        <span>技术</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" data-target="projects" data-src="projects.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/project.svg" class="nav-icon" alt="Projects"></div>
                        <span>项目</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" data-target="blogs" data-src="blogs.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/blog.svg" class="nav-icon" alt="Blog"></div>
                        <span>随记</span>
                    </div>
                </li>
                 <li class="nav-item">
                    <div class="nav-link" data-target="tools" data-src="tools.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/tool.svg" class="nav-icon" alt="Tool"></div>
                        <span>工具</span>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="nav-link" data-target="about" data-src="about.html">
                        <div class="nav-icon-wrapper"><img src="assets/icons/aboutMe.svg" class="nav-icon" alt="About"></div>
                        <span>关于</span>
                    </div>
                </li>
            
            </ul>
        </aside>

        <!-- 视口区域 -->
        <main class="viewport" id="viewport">
            <!-- 骨架屏 -->
            <div class="skeleton-screen" id="skeleton-screen">
                <div class="skeleton skeleton-header"></div>
                <div class="skeleton-grid">
                    <div class="skeleton skeleton-card"></div>
                    <div class="skeleton skeleton-card"></div>
                    <div class="skeleton skeleton-card"></div>
                </div>
            </div>
            
            <!-- 滑动容器 -->
            <div id="page-slider">
                <!-- Iframes will be injected here -->
            </div>
        </main>
    </div>

    <script>
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./sw.js').catch(err => console.log('SW failed', err));
            });
        }

        class PageSlider {
            constructor() {
                this.slider = document.getElementById('page-slider');
                this.navLinks = document.querySelectorAll('.nav-link');
                this.pages = Array.from(this.navLinks).map(link => ({
                    id: link.dataset.target,
                    src: link.dataset.src
                }));
                this.currentIndex = 0;
                this.isAnimating = false;
                
                // Touch state
                this.startX = 0;
                this.currentX = 0;
                this.isDragging = false;
                
                this.init();
            }

            init() {
                // Initialize iframes
                this.pages.forEach((page, index) => {
                    const iframe = document.createElement('iframe');
                    iframe.className = 'page-frame';
                    iframe.dataset.id = page.id;
                    
                    // Attach load event for theme sync
                    iframe.addEventListener('load', () => {
                        if (window.getCurrentTheme) {
                            applyThemeToFrame(iframe, window.getCurrentTheme());
                        }
                        if (index === 0) document.getElementById('skeleton-screen').classList.add('hidden');
                    });

                    // Only load the first page immediately
                    if (index === 0) {
                        iframe.src = page.src;
                    }
                    this.slider.appendChild(iframe);
                });

                // Lazy load others
                setTimeout(() => this.loadOtherPages(), 2000);

                // Bind Nav Events
                this.navLinks.forEach((link, index) => {
                    link.addEventListener('click', () => this.goToPage(index));
                });

                // Bind Touch Events
                const viewport = document.getElementById('viewport');
                viewport.addEventListener('touchstart', this.handleTouchStart.bind(this), { passive: true });
                viewport.addEventListener('touchmove', this.handleTouchMove.bind(this), { passive: false });
                viewport.addEventListener('touchend', this.handleTouchEnd.bind(this));
            }

            loadOtherPages() {
                const frames = this.slider.querySelectorAll('iframe');
                frames.forEach((frame, index) => {
                    if (index !== 0 && !frame.src) {
                        frame.src = this.pages[index].src;
                    }
                });
            }

            goToPage(index) {
                if (index === this.currentIndex) return;
                
                // Update Nav UI
                this.navLinks.forEach(l => l.classList.remove('active'));
                this.navLinks[index].classList.add('active');

                // Animate Slider
                this.currentIndex = index;
                this.updateSliderPosition(true);

                // Mobile Sidebar Logic (Auto close on selection)
                if (window.innerWidth <= 768) {
                    toggleMenu(false); // Close menu
                }
            }

            updateSliderPosition(animate = false) {
                const offset = -(this.currentIndex * 100);
                
                if (animate) {
                    // Optimized cubic-bezier for silkier transition
                    this.slider.style.transition = 'transform 0.6s cubic-bezier(0.22, 1, 0.36, 1)';
                } else {
                    this.slider.style.transition = 'none';
                }
                
                this.slider.style.transform = `translate3d(${offset}%, 0, 0)`;
            }

            // Touch Handlers
            handleTouchStart(e) {
                this.startX = e.touches[0].clientX;
                this.isDragging = true;
                this.slider.style.transition = 'none';
            }

            handleTouchMove(e) {
                if (!this.isDragging) return;
                
                const x = e.touches[0].clientX;
                const diff = x - this.startX;
                const width = this.slider.clientWidth;
                
                // Prevent overscrolling at edges
                if ((this.currentIndex === 0 && diff > 0) || 
                    (this.currentIndex === this.pages.length - 1 && diff < 0)) {
                    // Resistance effect
                    const resistance = diff * 0.3;
                    const offset = -(this.currentIndex * 100) + (resistance / width * 100);
                    this.slider.style.transform = `translate3d(${offset}%, 0, 0)`;
                } else {
                    const offset = -(this.currentIndex * 100) + (diff / width * 100);
                    this.slider.style.transform = `translate3d(${offset}%, 0, 0)`;
                }
                
                // Prevent default scrolling if moving horizontally
                if (Math.abs(diff) > 5) {
                    if(e.cancelable) e.preventDefault();
                }
            }

            handleTouchEnd(e) {
                if (!this.isDragging) return;
                this.isDragging = false;
                
                const endX = e.changedTouches[0].clientX;
                const diff = endX - this.startX;
                const threshold = this.slider.clientWidth * 0.2; // 20% width threshold
                
                if (diff > threshold && this.currentIndex > 0) {
                    this.goToPage(this.currentIndex - 1);
                } else if (diff < -threshold && this.currentIndex < this.pages.length - 1) {
                    this.goToPage(this.currentIndex + 1);
                } else {
                    // Revert
                    this.updateSliderPosition(true);
                }
            }
        }

        // Initialize App
        const app = new PageSlider();

        // --- Mobile Menu Logic ---
        const sidebar = document.getElementById('sidebar');
        const hamburger = document.getElementById('hamburger-btn');
        const overlay = document.getElementById('sidebar-overlay');

        function toggleMenu(force) {
            const isActive = typeof force === 'boolean' ? force : !sidebar.classList.contains('active');
            
            if (isActive) {
                sidebar.classList.add('active');
                hamburger.classList.add('active');
                overlay.classList.add('active');
                document.body.style.overflow = 'hidden'; // Prevent background scrolling
            } else {
                sidebar.classList.remove('active');
                hamburger.classList.remove('active');
                overlay.classList.remove('active');
                document.body.style.overflow = '';
            }
        }

        hamburger.addEventListener('click', () => toggleMenu());
        overlay.addEventListener('click', () => toggleMenu(false));

        // Avatar Easter Egg
        const avatar = document.getElementById('avatar');
        const floatText = document.getElementById('floating-text');
        const messages = ['Wait!', 'Hey!', 'Stop touching!', 'I am ticklish!', 'Ow!', 'Hahaha!'];
        let msgIdx = 0;
        let floatTimeout;

        avatar.addEventListener('click', (e) => {
            // Prevent default behavior to ensure fast response
            e.preventDefault();
            e.stopPropagation();

            // Clear previous timer to prevent flickering
            if(floatTimeout) clearTimeout(floatTimeout);
            
            // Randomize message slightly
            floatText.textContent = messages[msgIdx % messages.length];
            
            // Force reflow to restart animation if needed
            floatText.classList.remove('show');
            void floatText.offsetWidth; // Trigger reflow
            floatText.classList.add('show');
            
            // Add shake animation to avatar
            avatar.style.transform = `scale(1.05) rotate(${Math.random() * 10 - 5}deg)`;
            setTimeout(() => avatar.style.transform = '', 200);

            floatTimeout = setTimeout(() => {
                floatText.classList.remove('show');
            }, 1500); // Show for longer
            
            msgIdx++;
        });

        // --- Theme Switcher Logic (Light/Dark Toggle) ---
        const themeBtn = document.getElementById('theme-btn');
        const iconDark = document.getElementById('icon-dark');
        const iconLight = document.getElementById('icon-light');
        let isDarkMode = true; // Default

        // Light Theme Colors
        const lightTheme = {
            '--bg-primary': '#F1F5F9',
            '--bg-secondary': '#FFFFFF',
            '--bg-tertiary': '#E2E8F0',
            '--text-primary': '#0F172A',
            '--text-secondary': '#475569',
            '--text-muted': '#64748B',
            '--glass-bg': 'rgba(255, 255, 255, 0.7)',
            '--glass-bg-hover': 'rgba(255, 255, 255, 0.9)',
            '--glass-border': 'rgba(0, 0, 0, 0.05)',
            '--shadow-sm': '0 2px 4px rgba(0, 0, 0, 0.05)',
            '--shadow-md': '0 4px 6px rgba(0, 0, 0, 0.1)',
            '--shadow-lg': '0 10px 15px rgba(0, 0, 0, 0.1)',
            '--accent-blue': '#4F46E5', 
            '--accent-purple': '#7C3AED',
            '--hero-text-gradient': 'linear-gradient(to right, #0F172A, #475569)',
            '--stat-color': '#0F172A',
            '--nav-icon-filter': 'invert(1) grayscale(1) brightness(0.5)',
            '--nav-icon-active-filter': 'invert(1) grayscale(0) brightness(0.8) drop-shadow(0 0 2px rgba(79, 70, 229, 0.3))',
            '--skill-icon-filter': 'invert(1) brightness(0.5)',
            '--list-icon-filter': 'invert(1) brightness(0.5)',
            '--list-icon-colored-filter': 'none',
            '--tool-title-gradient': 'linear-gradient(to right, #0F172A, #475569)',
            '--input-bg': 'rgba(255, 255, 255, 0.5)'
        };

        // Dark Theme Colors (Deep Space Default)
        const darkTheme = {
            '--bg-primary': '#0B0C15',
            '--bg-secondary': '#151621',
            '--bg-tertiary': '#1E1F2E',
            '--text-primary': '#F8FAFC',
            '--text-secondary': '#94A3B8',
            '--text-muted': '#64748B',
            '--glass-bg': 'rgba(255, 255, 255, 0.03)',
            '--glass-bg-hover': 'rgba(255, 255, 255, 0.06)',
            '--glass-border': 'rgba(255, 255, 255, 0.08)',
            '--shadow-sm': '0 2px 4px rgba(0, 0, 0, 0.3)',
            '--shadow-md': '0 8px 16px rgba(0, 0, 0, 0.4)',
            '--shadow-lg': '0 16px 32px rgba(0, 0, 0, 0.5)',
            '--accent-blue': '#6366F1',
            '--accent-purple': '#8B5CF6',
            '--hero-text-gradient': 'linear-gradient(to right, #fff, #94a3b8)',
            '--stat-color': '#fff',
            '--nav-icon-filter': 'grayscale(1) brightness(0.7)',
            '--nav-icon-active-filter': 'grayscale(0) brightness(1) drop-shadow(0 0 5px var(--accent-blue))',
            '--skill-icon-filter': 'drop-shadow(0 0 10px rgba(99, 102, 241, 0.3))',
            '--list-icon-filter': 'drop-shadow(0 0 5px rgba(255,255,255,0.1))',
            '--list-icon-colored-filter': 'none',
            '--tool-title-gradient': 'linear-gradient(to right, #fff, #94a3b8)',
            '--input-bg': 'rgba(0, 0, 0, 0.2)',
            '--tool-card-icon-filter': 'drop-shadow(0 0 5px rgba(99, 102, 241, 0.5))',
            '--tool-nav-icon-filter': 'drop-shadow(0 2px 4px rgba(0,0,0,0.2))'
        };

        function applyThemeToFrame(frame, themeVars) {
            try {
                if (frame.contentDocument) {
                    const frameRoot = frame.contentDocument.documentElement;
                    for (const [key, value] of Object.entries(themeVars)) {
                        frameRoot.style.setProperty(key, value);
                    }
                }
            } catch(e) { console.error('Theme sync failed for frame', e); }
        }

        function applyTheme(themeVars) {
            const root = document.documentElement;
            for (const [key, value] of Object.entries(themeVars)) {
                root.style.setProperty(key, value);
            }
            
            // Sync with all existing iframes
            const frames = document.querySelectorAll('iframe');
            frames.forEach(frame => applyThemeToFrame(frame, themeVars));
        }

        themeBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            isDarkMode = !isDarkMode;
            
            const currentTheme = isDarkMode ? darkTheme : lightTheme;
            applyTheme(currentTheme);
            
            if (isDarkMode) {
                iconDark.style.display = 'block';
                iconLight.style.display = 'none';
            } else {
                iconDark.style.display = 'none';
                iconLight.style.display = 'block';
            }
        });

        // 暴露给 PageSlider 使用
        window.getCurrentTheme = () => isDarkMode ? darkTheme : lightTheme;
    </script>
</body>
</html>